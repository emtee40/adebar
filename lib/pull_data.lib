##############################################################################
# Adebar Â© 2014-2023 by Itzchak Rehberg
# This is part of the Adebar project, see https://codeberg.org/izzy/Adebar
# Protected by the GPLv2
# ----------------------------------------------------------------------------
# library to pull data from the device
##############################################################################

#
# Get Call-Log
#
getCallLog() {
  [[ $PULL_DATA -ne 1 ]] && return
  [[ $HAVE_ROOT -ne 1 ]] && return
  doProgress "- CallLog" 2

  local fields=( type number formatted_number numbertype via_number numberlabel normalized_number matched_number countryiso geocoded_location date last_modified name phone_account_address lookup_uri voicemail_uri is_read photo_id photo_uri post_dial_digits call_screening_app_name call_screening_component_name transcription transcription_state block_reason subscription_id subscription_component_name add_for_all_users features new presentation data_usage )
  local projection="_id"

  for field in ${fields[@]}; do
    projection="${projection}:${field}"
  done

  adb ${ADBOPTS} shell su -c "content query --uri content://call_log/calls --projection ${projection}" > ${DATADIR}/calllog.lst
}

#
# Get SMS
#
getSMS() {
  [ $PULL_DATA -ne 1 ] && return
  doProgress "- SMS" 2

  local msg
  local fields=( thread_id address person date date_sent protocol read status type reply_path_present subject body service_center locked sub_id error_code creator seen priority )
  local projection="_id"

  for field in ${fields[@]}; do
    projection="${projection}:${field}"
  done

  adb ${ADBOPTS} shell "content query --uri content://sms/ --projection ${projection}" > ${DATADIR}/sms.lst
}

getData() {
  [ $PULL_DATA -ne 1 ] && return
  doProgress "Pulling Data"
  getSMS
  getCallLog
}
